{% extends 'base.html' %}

{% block title %}Edit Kegiatan - Sistem Pendaftaran Kegiatan{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-pencil-square"></i> Edit Kegiatan: {{ event.title }}
                    </h4>
                </div>
                <div class="card-body p-4">
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {{ form.non_field_errors }}
                            </div>
                        {% endif %}
                        
                        <div class="mb-3">
                            <label for="{{ form.title.id_for_label }}" class="form-label">
                                <i class="bi bi-bookmark"></i> Judul Kegiatan *
                            </label>
                            {{ form.title }}
                            {% if form.title.errors %}
                                <div class="text-danger small">{{ form.title.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.category.id_for_label }}" class="form-label">
                                <i class="bi bi-tags"></i> Kategori Event *
                            </label>
                            <select name="{{ form.category.name }}" id="{{ form.category.id_for_label }}" class="form-control" required style="background-color: #FFFFFF; color: #1F2937; border: 1px solid #E5E7EB; border-radius: 8px; padding: 0.75rem;">
                                <option value="seminar" {% if event.category == 'seminar' %}selected{% endif %} style="background: #FFFFFF; color: #1F2937;">Seminar & Conference</option>
                                <option value="concert" {% if event.category == 'concert' %}selected{% endif %} style="background: #FFFFFF; color: #1F2937;">Concert & Festival</option>
                            </select>
                            {% if form.category.errors %}
                                <div class="text-danger small">{{ form.category.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.description.id_for_label }}" class="form-label">
                                <i class="bi bi-file-text"></i> Deskripsi Kegiatan *
                            </label>
                            {{ form.description }}
                            {% if form.description.errors %}
                                <div class="text-danger small">{{ form.description.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.event_date.id_for_label }}" class="form-label">
                                    <i class="bi bi-calendar"></i> Tanggal Kegiatan *
                                </label>
                                {{ form.event_date }}
                                {% if form.event_date.errors %}
                                    <div class="text-danger small">{{ form.event_date.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.event_time.id_for_label }}" class="form-label">
                                    <i class="bi bi-clock"></i> Waktu Kegiatan *
                                </label>
                                {{ form.event_time }}
                                {% if form.event_time.errors %}
                                    <div class="text-danger small">{{ form.event_time.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.location_type.id_for_label }}" class="form-label">
                                <i class="bi bi-geo-alt"></i> Tipe Lokasi *
                            </label>
                            <select name="{{ form.location_type.name }}" id="{{ form.location_type.id_for_label }}" class="form-control" required style="background-color: #FFFFFF; color: #1F2937; border: 1px solid #E5E7EB; border-radius: 8px; padding: 0.75rem;" onchange="toggleLocationFields()">
                                <option value="offline" {% if event.location_type == 'offline' %}selected{% endif %} style="background: #FFFFFF; color: #1F2937;">Offline</option>
                                <option value="online" {% if event.location_type == 'online' %}selected{% endif %} style="background: #FFFFFF; color: #1F2937;">Online</option>
                                <option value="hybrid" {% if event.location_type == 'hybrid' %}selected{% endif %} style="background: #FFFFFF; color: #1F2937;">Hybrid</option>
                            </select>
                            {% if form.location_type.errors %}
                                <div class="text-danger small">{{ form.location_type.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3" id="location-field">
                            <label for="{{ form.location.id_for_label }}" class="form-label">
                                <i class="bi bi-geo-alt"></i> Lokasi Kegiatan *
                            </label>
                            {{ form.location }}
                            {% if form.location.errors %}
                                <div class="text-danger small">{{ form.location.errors }}</div>
                            {% endif %}
                            <small class="text-muted">Alamat lengkap lokasi event (untuk offline/hybrid)</small>
                        </div>
                        
                        <div class="mb-3" id="zoom-fields" style="display: none;">
                            <label for="{{ form.zoom_link.id_for_label }}" class="form-label">
                                <i class="bi bi-camera-video"></i> Link Zoom Meeting
                            </label>
                            {{ form.zoom_link }}
                            {% if form.zoom_link.errors %}
                                <div class="text-danger small">{{ form.zoom_link.errors }}</div>
                            {% endif %}
                            <small class="text-muted">Contoh: https://zoom.us/j/1234567890</small>
                            
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <label for="{{ form.zoom_meeting_id.id_for_label }}" class="form-label">
                                        <i class="bi bi-hash"></i> Meeting ID
                                    </label>
                                    {{ form.zoom_meeting_id }}
                                    {% if form.zoom_meeting_id.errors %}
                                        <div class="text-danger small">{{ form.zoom_meeting_id.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    <label for="{{ form.zoom_passcode.id_for_label }}" class="form-label">
                                        <i class="bi bi-key"></i> Passcode
                                    </label>
                                    {{ form.zoom_passcode }}
                                    {% if form.zoom_passcode.errors %}
                                        <div class="text-danger small">{{ form.zoom_passcode.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="{{ form.price.id_for_label }}" class="form-label">
                                    <i class="bi bi-currency-dollar"></i> Harga Tiket
                                </label>
                                {{ form.price }}
                                {% if form.price.errors %}
                                    <div class="text-danger small">{{ form.price.errors }}</div>
                                {% endif %}
                                <small class="text-muted">Kosongkan jika event gratis</small>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="{{ form.bank_name.id_for_label }}" class="form-label">
                                    <i class="bi bi-bank"></i> Nama Bank
                                </label>
                                {{ form.bank_name }}
                                {% if form.bank_name.errors %}
                                    <div class="text-danger small">{{ form.bank_name.errors }}</div>
                                {% endif %}
                                <small class="text-muted">Contoh: BCA, Mandiri, BRI</small>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="{{ form.bank_account.id_for_label }}" class="form-label">
                                    <i class="bi bi-credit-card"></i> Nomor Rekening
                                </label>
                                {{ form.bank_account }}
                                {% if form.bank_account.errors %}
                                    <div class="text-danger small">{{ form.bank_account.errors }}</div>
                                {% endif %}
                                <small class="text-muted">Untuk pembayaran event</small>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.flyer.id_for_label }}" class="form-label">
                                    <i class="bi bi-image"></i> Flyer Kegiatan
                                </label>
                                {% if event.flyer %}
                                    <div class="mb-2">
                                        <img src="{{ event.flyer.url }}" alt="Current flyer" class="img-thumbnail" style="max-height: 200px;">
                                    </div>
                                {% endif %}
                                {{ form.flyer }}
                                {% if form.flyer.errors %}
                                    <div class="text-danger small">{{ form.flyer.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.certificate_template.id_for_label }}" class="form-label">
                                    <i class="bi bi-file-earmark-pdf"></i> Template Sertifikat
                                </label>
                                {{ form.certificate_template }}
                                {% if form.certificate_template.errors %}
                                    <div class="text-danger small">{{ form.certificate_template.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{% url 'events:list' %}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Batal
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> Update Kegiatan
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleLocationFields() {
    const locationType = document.getElementById('{{ form.location_type.id_for_label }}').value;
    const locationField = document.getElementById('location-field');
    const zoomFields = document.getElementById('zoom-fields');
    const locationInput = document.getElementById('{{ form.location.id_for_label }}');
    const zoomLinkInput = document.getElementById('{{ form.zoom_link.id_for_label }}');
    
    if (locationType === 'online') {
        locationField.style.display = 'none';
        zoomFields.style.display = 'block';
        if (locationInput) locationInput.required = false;
        if (zoomLinkInput) zoomLinkInput.required = true;
    } else if (locationType === 'hybrid') {
        locationField.style.display = 'block';
        zoomFields.style.display = 'block';
        if (locationInput) locationInput.required = true;
        if (zoomLinkInput) zoomLinkInput.required = true;
    } else {
        locationField.style.display = 'block';
        zoomFields.style.display = 'none';
        if (locationInput) locationInput.required = true;
        if (zoomLinkInput) zoomLinkInput.required = false;
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleLocationFields();
    // Set initial values if editing existing event
    {% if event.location_type == 'online' or event.location_type == 'hybrid' %}
        document.getElementById('zoom-fields').style.display = 'block';
    {% endif %}
    {% if event.location_type == 'online' %}
        document.getElementById('location-field').style.display = 'none';
    {% endif %}
});
</script>
{% endblock %}

